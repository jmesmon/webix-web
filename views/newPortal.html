<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="../echarts/echarts.min.js"></script>
    <script src="../echarts/theme.js"></script>
    <script src="../echarts/map/map-all.js"></script>
    <script src="../echarts/jquery-1.9.1.min.js"></script>
    <style>
        .contain {
            color: #fff;
            margin-right: 2px;
        }
        tr, td {
            /*border: 1px solid red;*/
            /*vertical-align: top;*/
        }
        .def_bk {
            background-color: rgba(0, 0, 0, 0.07);
            overflow: hidden;
        }
        .title{
            font-weight: bold; margin: 8px 0 0 8px
        }
        .table-c table{border-right:1px solid rgba(255, 255, 255, 0.47);border-bottom:1px solid rgba(255, 255, 255, 0.47)
        }
        .table-c table tr{height: 30px}
        .table-c table td{border-left:1px solid rgba(255, 255, 255, 0.47);border-top:1px solid rgba(255, 255, 255, 0.47); text-align: center}
        .point td {
            cursor: pointer;
        }
        a {
            color: #fff;
            text-decoration:none
        }
        a:hover{
            color: yellow;
            text-decoration:underline;
        }
        .module_title {
            font-weight: bold;
            padding: 5px 10px;
            background: rgba(5, 36, 60, 0.7);
        }
        .text-center{
            text-align: center;
        }
        .chart_bottom_title {
            height: 30px; padding: 4px;font-weight: bold;
            text-align: center;
        }
    </style>
</head>
<body>
<div class="contain">
    <!--分局工作情况-->
    <table width="100%" height="750">
        <tr>
            <td class="def_bk" style="width:48%" valign="top">
                <div class="module_title text-center">全局警犬技术工作信息</div>
                <div id="order" class="table-c" style="height:450px;padding: 8px 16px 16px 16px">
                    <table border="0" cellspacing="0" cellpadding="0">
                        <tr style="height: 38px" class="point" onclick="doOrder" id="tab_header1">
                            <td style="min-width: 60px;width:8%">序号</td>
                            <td style="min-width: 120px;width: 19%" id="tab_1_1">单位名称</td>
                            <td style="min-width: 100px;width: 19%" onclick="doOrder(1, 2)" id="tab_1_2">训导员人数</td>
                            <td style="min-width: 90px;width: 19%" onclick="doOrder(1, 3)" id="tab_1_3">警犬总数</td>
                            <td style="min-width: 100px;width: 19%" onclick="doOrder(1, 4)" id="tab_1_4">警犬警力比</td>
                            <td style="min-width: 120px;width: 19%" onclick="doOrder(1, 5)" id="tab_1_5">前30日工作量（次数）</td>
                        </tr>
                        <tbody id="orderTable1">

                        </tbody>
                    </table>
                    <table border="0" cellspacing="0" cellpadding="0" style="margin-top: 10px;">
                        <tr style="height: 38px" class="point" onclick="doOrder" id="tab_header2">
                            <td style="min-width: 60px;width:8%">序号</td>
                            <td style="min-width: 120px;width: 19%" id="tab_2_1">单位名称</td>
                            <td style="min-width: 100px;width: 19%" onclick="doOrder(2, 2)" id="tab_2_2">训导员人数</td>
                            <td style="min-width: 90px;width: 19%" onclick="doOrder(2, 3)" id="tab_2_3">警犬总数</td>
                            <td style="min-width: 100px;width: 19%" onclick="doOrder(2, 4)" id="tab_2_4">警犬警力比</td>
                            <td style="min-width: 120px;width: 19%" onclick="doOrder(2, 5)" id="tab_2_5">前30日工作量（次数）</td>
                        </tr>
                        <tbody id="orderTable2">

                        </tbody>
                    </table>
                    <table border="0" cellspacing="0" cellpadding="0" style="width: 100%">
                        <tr style="height: 0px;">
                            <td style="min-width: 60px;width:8%"></td>
                            <td style="min-width: 120px;width: 19%"></td>
                            <td style="min-width: 100px;width: 19%" onclick="doOrder(2)"></td>
                            <td style="min-width: 90px;width: 19%" onclick="doOrder(3)"></td>
                            <td style="min-width: 100px;width: 19%" onclick="doOrder(4)"></td>
                            <td style="min-width: 120px;width: 19%" onclick="doOrder(5)"></td>
                        </tr>
                        <tbody id="orderTable3">

                        </tbody>
                    </table>
                </div>
            </td>
            <td style="width: 16px"></td>
            <td valign="top">
                <div class="def_bk" style="height:355px;">
                    <div class="module_title">
                        <span>动态新闻</span>
                        <span style="display: inline-block; float: right; font-weight: normal; cursor: pointer;" onclick="showNewsList('1')">更多</span>
                    </div>
                    <div style="height:10px;"></div>
                    <div style="overflow: hidden;height: 310px">
                            <table width="100%" id="newList">
                                <tr><td><div align="center"><img src="../assets/imgs/loading.gif" height="45px" width="45px"></div></td></tr>
                            </table>
                    </div>
                </div>
                <div style="height: 16px"></div>
                <div class="def_bk" style="height:375px">
                    <div class="module_title">
                        <span>通知公告</span>
                        <span style="display: inline-block; float: right; font-weight: normal; margin-right: 5px; cursor: pointer;" onclick="showNewsList('2')">更多</span>
                    </div>
                    <div style="height:10px;"></div>
                    <div style="overflow: hidden;height: 305px">
                            <table width="100%" id="newList2">
                            </table>
                    </div>
                </div>
            </td>
        </tr>
    </table>
    <div style="height: 16px;" id="gold_sp"></div>
    <!--全局各项指标-->
    <div class="module_title text-center" style="margin-bottom: -2px;" id="quanju_1">全局警犬技术力量分析</div>
    <table width="100%" id="gold_area">
        <tr style="height: 320px">
            <td style="width: 32%;">
                <div style="margin: 0 8px 0 0;height: 320px" class="def_bk">
                    <div><div align="center" style="height: 280px" id="qj_col1"><img style="margin-top: 80px" src="../assets/imgs/loading.gif" height="45px" width="45px"></div></div>
                    <div style="height: 30px; padding: 4px;font-weight: bold;" align="center">警犬占比</div>
                </div>
            </td>
            <td style="width: 32%;">
                <div style="margin: 0 8px 0 0;height: 320px" class="def_bk">
                    <div><div align="center" style="height: 280px" id="qj_col1_1"><img style="margin-top: 80px" src="../assets/imgs/loading.gif" height="45px" width="45px"></div></div>
                    <div style="height: 30px; padding: 4px;font-weight: bold;" align="center">警犬状态分布</div>
                </div>
            </td>
            <td style="width: 32%;">
                <div style="margin: 0 8px 0 0;height: 320px" class="def_bk">
                    <div><div align="center" style="height: 280px" id="qj_col2"><img style="margin-top: 80px" src="../assets/imgs/loading.gif" height="45px" width="45px"></div></div>
                    <div style="height: 30px; padding: 4px;font-weight: bold;" align="center">警犬专业构成</div>
                </div>
            </td>
        </tr>
        <tr style="height: 7px"></tr>
        <tr style="height: 320px">
            <td style="width: 32%;">
                <div style="margin: 0 8px 0 0;height: 320px" class="def_bk">
                    <div><div align="center" style="height: 280px" id="qj_col3"><img style="margin-top: 80px" src="../assets/imgs/loading.gif" height="45px" width="45px"></div></div>
                    <div style="height: 30px; padding: 4px;font-weight: bold;" align="center">训导员构成</div>
                </div>
            </td>
            <td style="width: 32%;">
                <div style="margin: 0 8px 0 0;height: 320px" class="def_bk">
                    <div><div align="center" style="height: 280px" id="qj_col4"><img style="margin-top: 80px" src="../assets/imgs/loading.gif" height="45px" width="45px"></div></div>
                    <div style="height: 30px; padding: 4px;font-weight: bold;" align="center">培训完成比</div>
                </div>
            </td>
            <td style="width: 32%;">
                <div style="margin: 0 0px 0 0;height: 320px" class="def_bk">
                    <div style="height: 280px" id="qj_col7"><div align="center"><img style="margin-top: 80px" src="../assets/imgs/loading.gif" height="45px" width="45px"></div></div>
                    <div style="height: 30px; padding: 4px;font-weight: bold;" align="center">繁育配发</div>
                </div>
            </td>
        </tr>
    </table>
    <div style="height: 16px;"></div>

    <!-- 警犬技术工作详情 全局/分局-->
    <div class="module_title text-center" style="margin-bottom: -2px;" id="qj_work_title">全局警犬技术工作量分析</div>
    <div id="qj_work_contain">
        <table style="width: 100%">
            <tr style="height: 300px">
                <td class="def_bk" style="width: 50%">
                    <div id="work_sum_1" style="height: 290px;"></div>
                    <div class="chart_bottom_title">搜爆安检</div>
                </td>
                <td style="width: 16px"></td>
                <td class="def_bk">
                    <div id="work_sum_2" style="height: 290px;"></div>
                    <div class="chart_bottom_title">治安防范</div>
                </td>
            </tr>
            <tr style="height: 8px;"> <td colspan="3"></td> </tr>
            <tr style="height: 300px">
                <td class="def_bk" style="width: 50%">
                    <div id="work_sum_3" style="height: 290px;"></div>
                    <div class="chart_bottom_title">其他（备勤）</div>
                </td>
                <td style="width: 16px"></td>
                <td class="def_bk">
                    <div id="work_sum_4" style="height: 290px;"></div>
                    <div class="chart_bottom_title">刑侦侦查</div>
                </td>
            </tr>
        </table>
    </div>

    <!-- 分局警犬技术工作详情 -->
    <div style="height: 16px;" id="map_padding"></div>
    <table width="100%"  id="map_contain">
        <tr>
            <td id="col1" class="def_bk" style="width: 50%" valign="top">
                <div class="module_title">分局警犬技术工作详情
                    <span style="display: inline-block; float: right;font-size: 12px;font-weight: normal; margin-top: 4px;">
                        <span style="font-weight: bold; font-weight: bold; display: inline-block;">警犬占比：</span>
                        <span style="display: inline-block; width: 18px;height: 14px;background: #00ff39"></span> 0-19
                        <span style="display: inline-block; width: 18px;height: 14px;background: #fefb12"></span> 20-30
                        <span style="display: inline-block; width: 18px;height: 14px;background: #fec23c"></span> 31-50
                        <span style="display: inline-block; width: 18px;height: 14px;background: #e73c43"></span> 大于50
                    </span>
                </div>
                <div style="height: 30px"></div>
                <div id="main" style="height:520px;"></div>
                <div style="height: 20px"></div>
                <div style=" height: 117px; margin: 0px 10px 0px 10px" class="table-c" id="specialData_id">
                    <table width="100%" border="0" cellspacing="0" cellpadding="0">
                        <tr onclick="onSpecialDataClick">
                            <td width="60px"></td>
                            <td width="60px" onclick="onSpecialDataClick('刑侦总队')" style="cursor: pointer;color: #00F1FF">刑侦总队</td>
                            <td width="60px" onclick="onSpecialDataClick('公交总队')" style="cursor: pointer;color: #00F1FF">公交总队</td>
                            <td width="60px" onclick="onSpecialDataClick('反特总队')" style="cursor: pointer;color: #00F1FF">反特总队</td>
                            <td width="60px" onclick="onSpecialDataClick('天安门分局')" style="cursor: pointer;color: #00F1FF">天安门<br>分局</td>
                            <td width="60px" onclick="onSpecialDataClick('西站分局')" style="cursor: pointer;color: #00F1FF">西站分局</td>
                            <!--<td width="60px" onclick="onSpecialDataClick('开发局分局')" style="cursor: pointer;color: #00F1FF">开发局<br>分局</td>-->
                            <td width="60px" onclick="onSpecialDataClick('清河分局')" style="cursor: pointer;color: #00F1FF">清河分局</td>
                        </tr>
                        <tbody id="special_da"> </tbody>
                    </table>
                </div>
            </td>
            <td style="width: 16px"></td>
            <td valign="top" class="def_bk">
                <div>
                    <div>
                        <div class="module_title"><span id="area_name"></span><span id="org_contact" style="display: inline-block; float: right; font-weight: normal;"></span></div>
                        <div style="margin: 16px 0 0 16px; line-height: 25px">
                            <table>
                                <tr style="height: 200px">
                                    <td style="width: 262px" valign="top"><div style=""><span id="policeman_num">
                                        <img src="" id="workUnitPic" width="260" height="200">
                                    </span></div></td>
                                    <td valign="top"><div style="height: 200px; overflow: hidden;padding: 8px;"><span style="font-weight: bold;">简介：</span><span id="workUnitDesc"></span></div></td>
                                </tr>
                            </table>
                        </div>
                        <div style="height: 140px; padding:10px">
                            <table width="100%">
                                <tr>
                                    <td style="width: 20%">
                                        <div id="fj_col1" style="width: 100%; height: 130px"><div align="center"><img style="margin-top: 80px" src="../assets/imgs/loading.gif" height="45px" width="45px"></div></div>
                                        <div align="center">警犬占比</div>
                                    </td>
                                    <td style="width: 20%">
                                        <div id="fj_col1_1" style="width: 100%; height: 130px"><div align="center"><img style="margin-top: 80px" src="../assets/imgs/loading.gif" height="45px" width="45px"></div></div>
                                        <div align="center">警犬状态</div>
                                    </td>
                                    <td style="width: 20%">
                                        <div id="fj_col2" style="width: 100%; height: 130px"><div align="center"><img style="margin-top: 80px" src="../assets/imgs/loading.gif" height="45px" width="45px"></div></div>
                                        <div align="center">警犬专业</div>
                                    </td>
                                    <td style="width: 20%">
                                        <div id="fj_col3" style="width: 100%; height: 130px"><div align="center"><img style="margin-top: 80px" src="../assets/imgs/loading.gif" height="45px" width="45px"></div></div>
                                        <div align="center">带犬力量分布图</div>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <div style="margin-top: 20px;">
                            <table width="100%">
                                <tr>
                                    <td>
                                        <table width="100%">
                                            <tr>
                                                <td style="width: 300px">
                                                    <div style="padding: 16px 0 0 8px;font-weight: bold;">警犬工作</div>
                                                </td>
                                                <td align="right" style="padding-right: 8px" class="table-c">
                                                    <table border="0" cellspacing="0" cellpadding="0" height="20">
                                                        <tr>
                                                            <td style="width: 80px;font-size:16px; background-color: #002F75;cursor: pointer" onclick="workChangeOrg(1)" id="work_type_org_1">搜爆安检</td>
                                                            <td style="width: 80px;font-size:16px;cursor: pointer" onclick="workChangeOrg(2)" id="work_type_org_2">治安防范</td>
                                                            <td style="width: 100px;font-size:16px;cursor: pointer" onclick="workChangeOrg(4)" id="work_type_org_4">其他(备勤)</td>
                                                            <td style="width: 80px;font-size:16px;cursor: pointer" onclick="workChangeOrg(3)" id="work_type_org_3">刑侦侦查</td>
                                                        </tr>
                                                    </table>
                                                </td>
                                            </tr>
                                        </table>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <div id="chart_1_contain">
                            <div id="chart_1" style="height: 250px;"></div>
                        </div>
                    </div>
                </div>
            </td>
        </tr>
    </table>

    <!--警犬品种，警犬年龄-->
    <div style="height: 16px;"></div>
    <table width="100%" id="breed_age_area">
        <tr style="height: 350px">
            <td style="width: 50%;"  class="def_bk">
                <div class="title">
                    <table width="100%">
                        <tr>
                            <td style="width: 300px">
                                <div style="font-weight: bold;">民警分析（总人数：<span id="police_qty"></span>）</div>
                            </td>
                            <td align="right" style="padding-right: 8px;font-weight: normal" class="table-c">
                                <table border="0" cellspacing="0" cellpadding="0" height="20">
                                    <tr>
                                        <td style="width: 50px;font-size:16px;cursor: pointer; background-color: #002F75;" onclick="workChangeUser(3)" id="change_user_3">类别</td>
                                        <td style="width: 50px;font-size:16px;cursor: pointer" onclick="workChangeUser(2)" id="change_user_2">职务</td>
                                        <td style="width: 50px;font-size:16px;cursor: pointer" onclick="workChangeUser(1)" id="change_user_1">职称</td>
                                        <td style="width: 50px;font-size:16px;cursor: pointer" onclick="workChangeUser(4)" id="change_user_4">学历</td>
                                        <td style="width: 50px;font-size:16px;cursor: pointer" onclick="workChangeUser(6)" id="change_user_6">年龄</td>
                                        <td style="width: 50px;font-size:16px;cursor: pointer" onclick="workChangeUser(5)" id="change_user_5">性别</td>
                                    </tr>
                                </table>
                            </td>
                        </tr>
                    </table>
                </div>
                <div id="user_analysis" style="height: 330px"></div>
            </td>
            <td style="width: 16px;"></td>
            <td class="def_bk">
                <div class="title">
                    <table width="100%">
                        <tr>
                            <td style="width: 300px">
                                <div style="font-weight: bold;">警犬分析（总犬数：<span id="all_dog_qty"></span>）</div>
                            </td>
                            <td align="right" style="padding-right: 8px;font-weight: normal" class="table-c">
                                <table border="0" cellspacing="0" cellpadding="0" height="20">
                                    <tr>
                                        <td style="width: 50px;font-size:16px; background-color: #002F75;cursor: pointer" onclick="workChangeBreed(1)" id="breed_1">品种</td>
                                        <!--<td style="width: 50px;font-size:16px;cursor: pointer" onclick="workChangeBreed(2)" id="breed_2">毛色</td>-->
                                        <!--<td style="width: 50px;font-size:16px;cursor: pointer" onclick="workChangeBreed(3)" id="breed_3">毛型</td>-->
                                        <td style="width: 50px;font-size:16px;cursor: pointer" onclick="workChangeBreed(4)" id="breed_4">专业</td>
                                        <td style="width: 50px;font-size:16px;cursor: pointer" onclick="workChangeBreed(6)" id="breed_6">年龄</td>
                                        <td style="width: 83px;font-size:16px;cursor: pointer" onclick="workChangeBreed(5)" id="breed_5">警犬状态</td>
                                    </tr>
                                </table>
                            </td>
                        </tr>
                    </table>
                </div>
                <div id="dog_analysis" style="height: 330px"></div>
            </td>
        </tr>
    </table>
</div>
</body>
<script>
    function showNewsList(newType) {
        var url = location.href;
        url = url.split('views')[0];
        url = url + '#!/app/news.showList' ;
        localStorage.setItem("newType", newType);
        window.open(url, '_parent');
    }
    function showNews(id){
        sessionStorage.removeItem("newId");
        sessionStorage.setItem("newId", id);
        // parent.window.open('../#!/news.detail:id=' + id, '_blank');
        parent.window.open('../views/read.html?id=' + id, '_blank');
    }
    (function(){
        var w = $(window).width();
    })();
    var USER_INFO = parent.USER_INFO;
    var USER_ROLE = USER_INFO.userRole;

    var is_show_all = true;
    if(USER_ROLE != 'JuZhang' && USER_ROLE != 'SuperMan' && USER_ROLE != 'JiuZhiDui' && USER_ROLE != 'FJ_JuZhang'  ) {
        is_show_all = false;
        //如果是分局登录，全局各项指标不可见
        $('#gold_sp').hide();
        // $('#gold_area').hide();
        // $('#breed_age_area').hide();
        $('#gold_work_area').hide();
        $('#gold_work_sp').hide();
        //隐藏 警犬技术工作量分析
        $('#qj_work_title').hide();
        $('#qj_work_contain').hide();

        //隐藏 全局警犬技术力量分析
        $('#map_padding').hide();
        $('#quanju_1').hide();
        $('#gold_area').hide();
        //隐藏 分局警犬技术工作详情、
        // $('#map_contain').hide();

        $('#qj_work_title').html('分局警犬技术工作量分析')

    }
    var UNIT_DATA = [];
    var allTrainedQty = 0;
    var allUntrainQty = 0;
    var unitTrainQty = 0;
    var unitUntrainQty = 0;
    var allPoliceQty = 0;
    var allDogQty = 0;
    var tutor = 0;

    var curDogQty = 0;
    var curPoliceQty = 0;

    var table1Data = []; //表格1，3条数据
    var table2Data = []; //表格2，19条数据
    var table3Data = []; //表格3，社会化犬防

    var workUnitDataMapping = {};
    var areaDataMapping = {
        密云区: { orgName: '密云分局', policeman: 1072, dog: 20, pic: '/policeDog/resource/2017-10-04/1507106538662.jpg', desc: ''},
        怀柔区: { orgName: '怀柔分局', policeman: 936, dog: 39, pic: '/policeDog/resource/2017-10-04/1507106538679.jpg', desc: ''},
        延庆区: { orgName: '延庆分局', policeman: 917, dog: 20, pic: '/policeDog/resource/2017-10-04/1507106538719.jpg', desc: ''},
        昌平区: { orgName: '昌平分局', policeman: 2000, dog: 40, pic: '/policeDog/resource/2017-10-04/1507106538856.jpg', desc: ''},
        顺义区: { orgName: '顺义分局', policeman: 1631, dog: 54, pic: '/policeDog/resource/2017-10-04/1507106538961.jpg', desc: ''},
        平谷区: { orgName: '平谷分局', policeman: 838, dog: 35, pic: '/policeDog/resource/2017-10-07/1507378384611.jpg', desc: ''},
        门头沟区: { orgName: '门头沟分局', policeman: 773, dog: 42, pic: '/policeDog/resource/2017-10-07/1507378386863.jpg', desc: ''},
        海淀区: { orgName: '海淀分局', policeman: 5050, dog: 51, pic: '/policeDog/resource/2017-10-07/1507378389648.jpg', desc: ''},
        朝阳区: { orgName: '朝阳分局', policeman: 4599, dog: 115, pic: '/policeDog/resource/2017-10-07/1507378389648.jpg', desc: ''},
        东城区: { orgName: '东城分局', policeman: 3200, dog: 87, pic: '/policeDog/resource/2017-10-07/1507378389804.jpg', desc: ''},
        西城区: { orgName: '西城分局', policeman: 3615, dog: 85, pic: '/policeDog/resource/2017-10-06/1507294921071.jpg', desc: ''},
        石景山区: { orgName: '石景山分局', policeman: 1073, dog: 30, pic: '/policeDog/resource/2017-10-04/1507121919501.jpg', desc: ''},
        通州区: { orgName: '通州分局', policeman: 3260, dog: 65, pic: '/policeDog/resource/2017-10-07/1507378702645.JPG', desc: ''},
        丰台区: { orgName: '丰台分局', policeman: 3148, dog: 42, pic: '/policeDog/resource/2017-10-07/1507378702645.JPG', desc: ''},
        房山区: { orgName: '房山分局', policeman: 1596, dog: 39, pic: '/policeDog/resource/2017-10-07/1507378702645.JPG', desc: ''},
        大兴区: { orgName: '大兴分局', policeman: 2059, dog: 48, pic: '/policeDog/resource/2017-10-07/1507378702645.JPG', desc: ''},
        大兴区2: { orgName: '刑侦总队', policeman: 2059, dog: 48, pic: '/policeDog/resource/2017-10-07/1507378702645.JPG', desc: ''},
        大兴区3: { orgName: '公交总队', policeman: 2059, dog: 48, pic: '/policeDog/resource/2017-10-07/1507378702645.JPG', desc: ''},
        大兴区4: { orgName: '反特总队', policeman: 2059, dog: 48, pic: '/policeDog/resource/2017-10-07/1507378702645.JPG', desc: ''},
        大兴区5: { orgName: '天安门分局', policeman: 2059, dog: 48, pic: '/policeDog/resource/2017-10-07/1507378702645.JPG', desc: ''},
        大兴区6: { orgName: '西站分局', policeman: 2059, dog: 48, pic: '/policeDog/resource/2017-10-07/1507378702645.JPG', desc: ''},
        大兴区7: { orgName: '开发局分局', policeman: 2059, dog: 48, pic: '/policeDog/resource/2017-10-07/1507378702645.JPG', desc: ''},
        大兴区8: { orgName: '清河分局', policeman: 2059, dog: 48, pic: '/policeDog/resource/2017-10-07/1507378702645.JPG', desc: ''},
    };
    var otherFj = [];
    function renderOrgFj(){
        var policeCount = '<tr style="height: 23px"><td>民警总数</td>';
        var userCount = '<tr style="height: 23px"><td>带犬警力</td>';
        var docCount = '<tr style="height: 23px"><td>警犬总数</td>';
        var perCount = '<tr style="height: 23px"><td>警犬占比</td>';
        for(var i = 0; i<otherFj.length; i++) {
            var item = otherFj[i];
            item.per = parseInt(item.policeCount / item.dogCount) + ':1';
            policeCount += '<td>' + item.policeCount + '</td>';
            userCount += '<td>' + item.breederCount + '</td>';
            docCount += '<td>' + item.dogCount + '</td>';
            perCount += '<td>' + item.per + '</td>';
        }
        policeCount += '</tr>';
        userCount += '</tr>';
        docCount += '</tr>';
        perCount += '</tr>';
        $('#special_da').empty();
        $('#special_da').html( policeCount + userCount + docCount + perCount);
    }
    /*** 加载基础数据 开始 ***/
    (function(){
        parent.doPost('config/getOrgList', {}, function(res){
            if(res.success){
                UNIT_DATA = res.result;
                for(var i = 0; i<UNIT_DATA.length; i++){
                    var item = UNIT_DATA[i];
                    if(["警院", "机场", "警卫局", "振远", "消防", "开发局分局"].indexOf(item.orgName) != -1){
                        continue;
                    }

                    workUnitDataMapping[item.orgName] = item;
                    var areaData = areaDataMapping[item.orgArea];
                    if(areaData.orgName == item.orgName){
                        areaDataMapping[item.orgArea] = item;
                    }else{
                        for(var n in areaDataMapping){
                            if(areaDataMapping[n].orgName == item.orgName){
                                areaDataMapping[n] = item;
                                break;
                            }
                        }
                    }
                    item.jing_quan_bi_li = parseInt( item.empQty / item.dogQty) || 0;
                    allTrainedQty += item.trainedQty;
                    allUntrainQty += item.untrainQty;
                    if(item.orgName == USER_INFO.workUnit){
                        unitTrainQty = item.trainedQty;
                        unitUntrainQty = item.untrainQty;
                        curDogQty = item.dogQty;
                        curPoliceQty = item.empQty;
                    }
                    allPoliceQty += item.empQty;
                    // allDogQty += item.dogQty;
                    allDogQty = res.message;
                    tutor += item.policeCount;
                    // tutor = res.message;

                    if(["刑侦总队", "公交总队", "反特总队", "天安门分局", "西站分局", "清河分局"].indexOf(item.orgName) != -1){
                        table1Data.push(item);
                    }else if(["社会化犬防"].indexOf(item.orgName) != -1){
                        table3Data.push(item);
                    }else{
                        table2Data.push(item);
                    }
                    if(["刑侦总队", "公交总队", "反特总队", "天安门分局", "西站分局", "清河分局"].indexOf(item.orgName) != -1){
                        otherFj.push( {fj: item.orgName, policeCount: item.empQty, dogCount: item.dogQty, per: item.jing_quan_bi_li, workCount: item.workHours, newsCount: item.newQty, breederCount: item.policeCount || '0'} );
                    }
                }
                //渲染表格数据
                renderUnitInfo('orderTable1', table1Data);
                renderUnitInfo('orderTable2', table2Data);
                renderUnitInfo('orderTable3', table3Data);

                //渲染 培训完成比、警犬占比 数据
                var trainData = [
                    {name: '已培训', value: allTrainedQty},
                    {name: '未培训', value: allUntrainQty}
                ];
                var policeAndDogData = [
                    {name: '警犬总数', value: allDogQty},
                    {name: '民警总数', value: allPoliceQty}
                ];
                if(!is_show_all){
                    trainData = [
                        {name: '已培训', value: unitTrainQty},
                        {name: '未培训', value: unitUntrainQty}
                    ];
                    policeAndDogData = [
                        {name: '警犬总数', value: curDogQty},
                        {name: '民警总数', value: curPoliceQty}
                    ];
                }
                renderDogPowerData( '培训完成比', trainData, 'qj_col4');
                renderDogPowerData( '警犬占比', policeAndDogData, 'qj_col1');
                //渲染地图
                renderMap();
                //渲染地图下表格
                renderOrgFj();
            }
        });

        //渲染 繁育配发 数据
        parent.doPost('config/getBreedSumOrgList', {}, function(resp){
            console.log(resp);
            if(!resp.result){
                resp.result = {allotQty: 0, breedQty: 0};
            }
            var trainData = [
                {name: '繁育警犬', value: resp.result.breedQty},
                {name: '配发警犬', value: resp.result.allotQty}
            ];
            renderDogPowerData( '繁育配发', trainData, 'qj_col7');
        });
    })();
    /*** 加载基础数据 结束 ***/

    /** 表格：全局警犬技术工作信息 开始 **/
    function renderUnitInfo(domId, data){
        var html = '';

        for(var i = 0; i<data.length; i++){
            var item = data[i];
            html += '<tr style="height:26px;">';
            if(domId != 'orderTable3') {
                html += '<td style="min-width: 60px;width:8%">' + (i + 1) + '</td>';
            }else{
                html += '<td style="min-width: 60px;width:8%"></td>';
            }
            html += '<td style="min-width: 120px;width: 19%">' + (item.orgName || 0) + '</td>';
            html += '<td style="min-width: 100px;width: 19%">' + (item.policeCount || 0) + '</td>';
            html += '<td style="min-width: 90px;width: 19%">' + (item.dogQty || 0) + '</td>';
            if(item.jing_quan_bi_li > 50){
                html += '<td style="color: red;min-width: 100px;width: 19%"> ' + item.jing_quan_bi_li+ ' </td>'
            }else if(item.jing_quan_bi_li > 30){
                html += '<td style="color: yellow;min-width: 100px;width: 19%"> ' + item.jing_quan_bi_li+ ' </td>'
            }else if(item.jing_quan_bi_li > 19){
                html += '<td style="color: #00d4ff;min-width: 100px;width: 19%"> ' + item.jing_quan_bi_li+ ' </td>'
            }else{
                html += '<td style="color: #c4ffc4;min-width: 100px;width: 19%"> ' + item.jing_quan_bi_li+ ' </td>'
            }
            html += '<td style="min-width: 120px;width: 19%">' + (item.workQty || 0) + '</td>';
            html += '</tr>';
        }
        $('#' + domId).empty();
        $('#' + domId).html( html);
    }
    /** 全局警犬技术工作信息 结束 **/

    /** 新闻部分 开始 **/
    //动态新闻
    (function(){
        var params = {newsType: '动态新闻', workUnit: USER_INFO.workUnit};
        if(is_show_all){
            params = {newsType: '动态新闻'};
        }
        parent.doPost('news/getList/14/1', params, function(resp){
            var data = resp.result;
            var ht = '';
            for(var i =0; i<data.length; i++){
                var ne = data[i];
                var title = ne.title;
                if(title.length > 24){
                    title = title.substr(0, 23) + '...';
                }
                ht += '<tr>' +
                    '<td style="width: 120px" align="center">【' + ne.workUnit + '】</td>' +
                    '<td><a href="javascript:void(0)"><div style="overflow: hidden" onclick="showNews('+ne.id+')">' + title + '</div></a></td>' +
                    '<td style="width: 120px" align="center">' + ne.publishDate.split(' ')[0] + '</td>' +
                    '</tr>';
            }
            $('#newList').empty();
            $('#newList').append(ht);
        });
    })();
    //通知公告
    (function (){
        var params = {newsType: '通知公告'};
        if(!is_show_all){
            params = {newsType: '通知公告', state: USER_INFO.workUnit};
        }
        parent.doPost('news/getList/14/1', params, function(resp){
            var data = resp.result;
            var ht = '';
            for(var i =0; i<data.length; i++){
                var ne = data[i];
                var title = ne.title;
                if(title.length > 24){
                    title = title.substr(0, 23) + '...';
                }
                ht += '<tr>' +
                    '<td style="width: 120px" align="center">【' + ne.workUnit + '】</td>' +
                    '<td><a href="javascript:void(0)"><div style="overflow: hidden" onclick="showNews('+ne.id+')">' + title + '</div></a></td>' +
                    '<td style="width: 120px" align="center">' + ne.publishDate.split(' ')[0] + '</td>' +
                    '</tr>';
            }
            $('#newList2').empty();
            $('#newList2').append(ht);
        });
    })();
    /** 新闻部分 开始 **/

    /* ---------------3x3------------------- */
    var  radius = ['34%', '70%'];
    var label = {
        normal: {
            show: true,
            position: 'outside',
        }
    };
    var itemStyle = function(tag) {
        return {
            normal: {
                label: {
                    show: !tag,
                    formatter: "{b}：{c}\n({d}%)",
                    textStyle: {
                        fontSize: '16',
                    }
                }
            },
            emphasis: {
                shadowBlur: 10,
                shadowOffsetX: 0,
                shadowColor: 'rgba(0, 0, 0, 0.5)',

            }
        };
    };
    var dogProStyle = function (tag) {
        return {
            normal: {
                label: {
                    show: !tag,
                    formatter: "{b}\n{c} ({d}%)",
                    textStyle: {
                        fontSize: '16',
                    }
                },
                color: function (params) {
                    var color_mapping = {
                        搜毒: "#FFA500",
                        搜爆: "#ccca80",
                        治安防范: "#dcbf27",
                        救援: "#efa18d",

                        '搜捕(刑)': "#94dae3",
                        // 物证搜索: "#49c2e3",
                        '追踪(刑)': "#3893f3",
                        '鉴别(刑)': "#2059ee",
                        '物证搜索(刑)': "#0200e3",
                        其他: "#5de6ff",
                        未知: "#e2efde",
                    };
                    return color_mapping[params.name];
                }
            },
            emphasis: {
                shadowBlur: 10,
                shadowOffsetX: 0,
                shadowColor: 'rgba(0, 0, 0, 0.5)'
            }
        };
    };
    function renderDogPowerData(name, data, domId, tag, isPro) {
        var fontSize = '16';
        echarts.init(document.getElementById(domId), 'vintage').setOption({
            color: ["#00e35b", "#ffec1d"],
            tooltip: {
                trigger: 'item',
                formatter: "{a} <br/>{b}: {c} ({d}%)",
                position:function(p){   //其中p为当前鼠标的位置
                    return [p[0] + 10, p[1] - 10];
                }
            },
            series: [
                {
                    name: name, //'警犬占比：' + bl + ":1",
                    type: 'pie',
                    radius: radius,
                    itemStyle: isPro ? dogProStyle(tag) : itemStyle(tag),
                    data: data
                }
            ]
        });
    }
    var dogProMapping = {'1': '在训', '2': '出勤', '3': '淘汰', '4': '死亡', '5': '种犬', '6': '退役'};
    (function(){
        var params = {};
        if(!is_show_all){
            params.workUnit = USER_INFO.workUnit;
        }
        //警犬工作中状态、带犬人员职业数据
        parent.doPost('config/getDogPowerAnalysis', params, function (resp){
            if(resp.success){
                var workStage = []; //警犬状态分布
                var userType = []; //训导员构成
                for(var i = 0; i<resp.result.length; i++){
                    var item = resp.result[i];
                    if(item.xtype == 'workStage'){
                        workStage.push({name: dogProMapping[item.xname], value: item.qty});
                    }else if(item.xtype == 'workType'){
                        userType.push({name: item.xname || '其他', value: item.qty});
                    }
                }
                renderDogPowerData( '警犬状态分布', workStage, 'qj_col1_1');
                renderDogPowerData( '训导员构成', userType, 'qj_col3');
            }
        });
        //警犬专业数据
        parent.doPost('config/getDogProAnalysis', params, function (resp){
            console.log(resp);
            if(resp.success) {
                var data = [];
                for(var n in resp.result){
                    data.push({name: n, value: resp.result[n]})
                }
                renderDogPowerData('警犬专业构成', data, 'qj_col2', false, true);
            }
        });
    })();
    /* ---------------3x3 end------------------- */

    /** 全局警犬技术力量分析 开始 **/
    var renderWorkSumView = function (domId, xAxisData, data, color) {
        var option = {
            color: color,
            tooltip : {
                trigger: 'axis',
                axisPointer : {            // 坐标轴指示器，坐标轴触发有效
                    type : 'shadow'        // 默认为直线，可选为：'line' | 'shadow'
                }
            },
            grid: {
                top: '12%',
                left: '6%',
                right: '8%',
                bottom: '6%',
                containLabel: true
            },
            xAxis : [{
                type : 'category',
                splitLine: { show: false },
                axisLabel:{
                    interval: 0,
                    rotate: 0,
                    textStyle:{
                        fontSize: 14
                    }
                },
                data : xAxisData
            }],
            yAxis : [{
                type : 'value',
                splitLine: {
                    show: true,
                    lineStyle: {
                        color: 'rgba(255, 255, 255, 0.47)'
                    }
                }
            }],
            series : [{
                name:'累计',
                type:'bar',
                barWidth: '50%',
                label: {
                    normal: {
                        show: true,
                        position: 'top'
                    }
                },
                data: data
            }]
        };
        echarts.init(document.getElementById(domId), 'vintage').setOption(option);
    };
    (function(){
        //出勤次数、出勤人数、出勤犬数、安检面积（千平米）、安检车辆数、查获违禁品数（件）、查获毒品（克）
        var xAxios = ["出勤次数", "出勤人数", "出勤犬数", "安检面积\n(千平米)", "安检车辆数"];
        var data = [0, 0, 0, 0, 0 ];
        var color = ["#a8dc78"];
        renderWorkSumView('work_sum_1', xAxios, data, color);

        //巡逻次数、出勤人数、出勤犬数、巡逻时长（单位：小时）、查获违禁品数（件）、查获毒品（克）
        xAxios = ["巡逻次数", "出勤人数", "出勤犬数", "巡逻时长\n(小时)"];
        data = [0, 0, 0, 0 ];
        color = ["#adffc1"];
        renderWorkSumView('work_sum_2', xAxios, data, color);

        //备勤次数、出勤人数、出勤犬数、备勤时长（单位：小时）、查获违禁品数（件）、查获毒品（克）
        xAxios = ["备勤次数", "出勤人数", "出勤犬数", "备勤时长\n(小时)"];
        data = [0, 0, 0, 0 ];
        color = ["#dbe3ad"];
        renderWorkSumView('work_sum_3', xAxios, data, color);

        //出勤次数、出勤人数、出勤犬数、破案数、查获违禁品数（件）、查获毒品（克）
        xAxios = ["出勤次数", "出勤人数", "出勤犬数", "破案数"];
        data = [0, 0, 0, 0 ];
        color = ["#00cee3"];
        renderWorkSumView('work_sum_4', xAxios, data, color);
    })();
    //加载分局警犬技术工作详情
    function loadWorkSumAnalysis() {
        var params = {};
        if(!is_show_all){
            params.workUnit = USER_INFO.workUnit;
        }
        var domIdMapping = {"搜爆安检": "work_sum_1", "治安防范": "work_sum_2", "其他（备勤）": "work_sum_3", "刑侦侦查": "work_sum_4"};
        parent.doPost('work/getWorkSumAnalysis', params, function (resp) {
            if(resp.success){
                for(var i = 0; i<resp.result.length; i++) {
                    var item = resp.result[i];
                    var domId = domIdMapping[item.work_type];
                    var xAxios = [];
                    var data = [];
                    var color = [];
                    if(item.work_type == '搜爆安检'){
                        //出勤次数、出勤人数、出勤犬数、安检面积（千平米）、安检车辆数、查获违禁品数（件）、查获毒品（克）
                        xAxios = ["出勤次数", "出勤人数", "出勤犬数", "安检面积\n(千平米)", "安检车辆数"];
                        data = [item.att_qty || 0, item.att_per_qty || 0, item.att_dog_qty || 0,  parseInt(item.check_area/1000) || 0, item.check_car_qty || 0 ];
                        color = ["#a8dc78"];
                    }else if(item.work_type == '治安防范'){
                        //巡逻次数、出勤人数、出勤犬数、巡逻时长（单位：小时）、查获违禁品数（件）、查获毒品（克）
                        xAxios = ["巡逻次数", "出勤人数", "出勤犬数", "巡逻时长\n(小时)"];
                        data = [item.att_qty || 0, item.att_per_qty || 0, item.att_dog_qty || 0, item.work_hours || 0 ];
                        color = ["#adffc1"]
                    }else if(item.work_type == '其他（备勤）'){
                        //备勤次数、出勤人数、出勤犬数、备勤时长（单位：小时）、查获违禁品数（件）、查获毒品（克）
                        xAxios = ["备勤次数", "出勤人数", "出勤犬数", "备勤时长\n(小时)"];
                        data = [item.att_qty || 0, item.att_per_qty || 0, item.att_dog_qty || 0, item.work_hours || 0 ];
                        color = ["#dbe3ad"]
                    }else if(item.work_type == '刑侦侦查'){
                        //出勤次数、出勤人数、出勤犬数、破案数、查获违禁品数（件）、查获毒品（克）
                        xAxios = ["出勤次数", "出勤人数", "出勤犬数", "破案数"];
                        data = [item.att_qty || 0, item.att_per_qty || 0, item.att_dog_qty || 0, item.pa_qty || 0 ];
                        color = ["#00cee3"]
                    }

                    if(item.wjp_qty){
                        xAxios.push("查获违禁品\n数(件)");
                        data.push(item.wjp_qty);
                    }
                    if(item.dp_qty){
                        xAxios.push("查获毒品\n(克)");
                        data.push(item.dp_qty);
                    }
                    renderWorkSumView(domId, xAxios, data, color);
                }
            }
        });
    }
    loadWorkSumAnalysis();
    /** 全局警犬技术力量分析 结束 **/

    /** 底部图表 开始 **/
    //警犬分析-数据提取分析
    var dogAnalysis = {
            breed: [],
            dog_colour: [],
            hair_type: [],
            dog_level: [],
            work_stage: [],
            pro: [],
            age: []
        };
    parent.doPost('config/getDogAnalysis', {}, function(resp){
        if(resp.success){
            var arr = resp.result;
            for(var i = 0; i<arr.length; i++){
                var item = arr[i];
                var a = dogAnalysis[item.ctype];
                if(a){
                    a.push(item);
                }
            }
            console.log(dogAnalysis);
            renderDogByType('breed', '品种');

            var d = dogAnalysis['age'];
            var qty = 0;
            for(var i = 0; i<d.length; i++){
                qty += d[i].val;
            }
            $('#all_dog_qty').html(qty);
        }
    });
    //警犬分析
    var lastBreed = 1;
    function workChangeBreed(tag){
        if(tag != lastBreed){
            $('#breed_' + lastBreed).css('backgroundColor', '');
            $('#breed_' + tag).css('backgroundColor', '#002F75');
            lastBreed = tag;
            switch (tag){
                case 1:
                    renderDogByType('breed', '品种');
                    break;
                case 2:
                    renderDogByType('dog_colour', '毛色');
                    break;
                case 3:
                    renderDogByType('hair_type', '毛型');
                    break;
                case 4:
                    renderDogByType('pro', '专业');
                    break;
                case 5:
                    renderDogByType('work_stage', '警犬状态');
                    break;
                case 6:
                    renderDogByType('age', '年龄');
                    break;
                default:
                    renderDogByType('breed', '专业');
                    break;

            }
        }
    }
    //民警分析
    var lastUser = 3;
    function workChangeUser(tag){
        if(tag != lastUser){
            $('#change_user_' + lastUser).css('backgroundColor', '');
            $('#change_user_' + tag).css('backgroundColor', '#002F75');
            lastUser = tag;
            switch (tag){
                case 1:
                    renderUserByType('job_title', '职称');
                    break;
                case 2:
                    renderUserByType('job', '职务');
                    break;
                case 3:
                    renderUserByType('work_type', '类别');
                    break;
                case 4:
                    renderUserByType('degree', '学历');
                    break;
                case 5:
                    renderUserByType('sex', '性别');
                    break;
                default:
                    renderUserByType('age', '年龄');
                    break;

            }
        }
    }
    function renderDog(name, legendData, data) {
        echarts.init(document.getElementById('dog_analysis'), 'vintage').setOption({
            tooltip: {
                trigger: 'item',
                formatter: "{a} <br/>{b} : {c} ({d}%)"
            },
            legend: {
                orient: 'vertical',
                right: 'right',
                bottom: 10,
                data: legendData
            },
            series: [
                {
                    name: name,
                    type: 'pie',
                    center: ['40%', '50%'],
                    data: data,
                    itemStyle: {
                        normal: {
                            label: {
                                show: true,
                                formatter: "{b}:{c}",
                                textStyle: {
                                    fontSize: '14',
                                }
                            }
                        },
                        emphasis: {
                            shadowBlur: 10,
                            shadowOffsetX: 0,
                            shadowColor: 'rgba(0, 0, 0, 0.5)',

                        }
                    }
                }
            ]
        });
    }
    function renderDogByType(name, cName){
        var ori_data = dogAnalysis[name];
        var legendData = [], da = [];
        for(var i = 0 ; i<ori_data.length; i++){
            var ite = ori_data[i];
            if(name == 'work_stage'){
                var ntitle = dogProMapping[ite.att_name] || ite.att_name;
                legendData.push(ntitle);
                da.push({"name": ntitle, "value": ite.val});
            }else {
                legendData.push(ite.att_name);
                da.push({"name": ite.att_name, "value": ite.val});
            }
        }
        renderDog(cName, legendData, da);
    }
    //民警分析
    function renderAllUser(name, legendData, data) {
        echarts.init(document.getElementById('user_analysis'), 'vintage').setOption({
            tooltip: {
                trigger: 'item',
                formatter: "{a} <br/>{b} : {c} ({d}%)"
            },
            legend: {
                orient: 'vertical',
                right: 'left',
                bottom: 10,
                data: legendData
            },
            series: [
                {
                    name: name,
                    type: 'pie',
                    center: ['40%', '50%'],
                    data: data,
                    itemStyle: {
                        normal: {
                            label: {
                                show: true,
                                formatter: "{b}：{c}",
                                textStyle: {
                                    fontSize: '14',
                                }
                            }
                        },
                        emphasis: {
                            shadowBlur: 10,
                            shadowOffsetX: 0,
                            shadowColor: 'rgba(0, 0, 0, 0.5)',

                        }
                    }
                }
            ]
        });
    }
    //民警分析-数据提取分析
    function renderUserByType(name, cName){
        var ori_data = userAnalysis[name];
        var legendData = [], da = [];
        for(var i = 0 ; i<ori_data.length; i++){
            var ite = ori_data[i];
            legendData.push(ite.att_name);
            da.push( {"name": ite.att_name, "value": ite.val} );
        }
        renderAllUser(cName, legendData, da);
    }
    var userAnalysis = {
        sex: [],
        degree: [],
        work_type: [],
        job_title: [],
        job: [],
        age: []
    };
    parent.doPost('config/getUserAnalysis', {}, function(resp){
        if(resp.success){
            var arr = resp.result;
            for(var i = 0; i<arr.length; i++){
                var item = arr[i];
                var a = userAnalysis[item.ctype];
                if(a){
                    a.push(item);
                }
            }
            renderUserByType('work_type', '类别');
            var d = userAnalysis['sex'];
            var qty = 0;
            for(var i = 0; i<d.length; i++){
                qty += d[i].val;
            }
            $('#police_qty').html(qty);
        }
    });
    /** 底部图表 结束 **/

    var lastClick = {"1": "", "2": ""};
    var lastDesc = {"1": "desc", "2": "desc"};
    function doOrder(tabNum, colNum){
        var curOrderBy = '';
        var data = [];
        if(tabNum == 1){
            data = table1Data;
        }else if(tabNum == 2){
            data = table2Data;
        }
        if(lastClick[tabNum] != colNum) {
            $('#tab_' + tabNum + '_' + lastClick[tabNum]).text($('#tab_' + tabNum + '_' + lastClick[tabNum]).text().replace('↓', '').replace('↑', ''));
            $('#tab_' + tabNum + '_' + colNum).text($('#tab_' + tabNum + '_' + colNum).text() + '↓');
            lastClick[tabNum] = colNum;
            lastDesc[tabNum] = 'desc';
        }else{
            if(lastDesc[tabNum] == 'desc'){
                $('#tab_' + tabNum + '_' + lastClick[tabNum]).text($('#tab_' + tabNum + '_' + lastClick[tabNum]).text().replace('↓', '↑'));
            }else{
                $('#tab_' + tabNum + '_' + lastClick[tabNum]).text($('#tab_' + tabNum + '_' + lastClick[tabNum]).text().replace('↑', '↓'));
            }
            lastDesc[tabNum] = (lastDesc[tabNum] == 'desc' ?  'asc' : 'desc');
        }
        var fieldMapping = {"2": "policeCount", "3": "dogQty", "4": "jing_quan_bi_li", "5": "workQty"};
        orderByPer(fieldMapping[colNum], data, lastDesc[tabNum]);
        renderUnitInfo('orderTable' + tabNum, data);
    }
    function orderByPer(field, data, orderBy){
        console.log(orderBy);
        data.sort(function(a, b){
            var rst = 1;
            if( a[field] < b[field] ) {
                rst = 1
            }else if( a[field] > b[field] ){
                rst = -1;
            }else{
                rst = 0;
            }
            if(orderBy == 'asc'){
                rst = 0 - rst;
            }
            return rst;
        });
    }
    /// =============================================地图部分
    function renderOrgDesc(name){
        for(var i in areaDataMapping){
            var item = areaDataMapping[i];
            if(item.orgName == name){
                $('#org_contact').text('负责人：' + item.orgLeader + '，联系方式：' + item.orgConcat);
                document.getElementById('workUnitPic').src = item.orgPic;
                $('#workUnitDesc').text(item.orgDesc);
                $('#area_name').text(item.orgName);
                break;
            }
        }
        renderOrgChart(name);
    }
    function renderAreaData(workUnit) {
        workUnit = workUnit || '刑侦总队';
        parent.doPost('dogBaseInfo/getAnalysisData', {workUnit: workUnit}, function (resp) {
            if (resp.success) {
                var arr = resp.result;
                var data = {};
                var pr_name = [];
                var pr_data = [];

                var workStage_name = [];
                var workStage_data = [];
                var workStage = {};
                for (var i = 0; i < arr.length; i++) {
                    var key = arr[i].att_name;
                    data[key] = arr[i].val;
                    if (key.indexOf("pro_") != -1) {
                        pr_name.push(key.replace('pro_', ''));
                        pr_data.push({value: arr[i].val, name: key.replace('pro_', '')});
                    }
                    if (key.indexOf("workStage_") != -1) {
                        workStage_name.push(dogProMapping[key.replace('workStage_', '')]);
                        workStage_data.push({value: arr[i].val, name: key.replace('workStage_', '')});
                        workStage['st' + key.replace('workStage_', '')] = arr[i].val;
                    }
                }
                try{
                    renderUserDog(data, 'fj_col1', 1);
                }catch(e){}
                try{
                    renderDogWorkStage(workStage, 'fj_col1_1', 1);
                }catch(e){}
                try{
                    renderDogPro(pr_name, pr_data, 'fj_col2', 1, workUnit); //
                }catch(e){}
                try{
                    renderUser(data, 'fj_col3', 1);
                }catch(e){}
                try{
                    renderTickoutDie(data, 'fj_col5', 1);
                }catch(e){}
                try{
                    renderAllot(data, 'fj_col4', 1);
                }catch(e){}
            }
        });
    }
    var org_workData = {
        '其他（备勤）': [],
        '刑侦侦查': [],
        '搜爆安检': [],
        '治安防范': []
    };
    var lastTab_org = '1';
    function workChangeOrg(tag){
        if(tag != lastTab_org){
            $('#work_type_org_' + lastTab_org).css('backgroundColor', '');
            $('#work_type_org_' + tag).css('backgroundColor', '#002F75');
            lastTab_org = tag;
            switch (tag){
                case 1:
                    renderOrgMonthWork('搜爆安检');
                    break;
                case 2:
                    renderOrgMonthWork('治安防范');
                    break;
                case 3:
                    renderOrgMonthWork('刑侦侦查');
                    break;
                default:
                    renderOrgMonthWork('其他（备勤）');
                    break;

            }
        }
    }
    function getWorkDataByOrgName(orgName){
        var params = {workUnit: orgName};
        parent.doPost('work/getWorkSumAnalysis', params, function (resp) {
            if (resp.success) {
                if(resp.result.length == 0){
                    org_workData = {
                        '其他（备勤）': [],
                        '刑侦侦查': [],
                        '搜爆安检': [],
                        '治安防范': []
                    };
                }else{
                    for (var i = 0; i < resp.result.length; i++) {
                        var item = resp.result[i];
                        if(item.work_type == '搜爆安检'){
                            //出勤次数、出勤人数、出勤犬数、安检面积（千平米）、安检车辆数、查获违禁品数（件）、查获毒品（克）
                            xAxios = ["出勤次数", "出勤人数", "出勤犬数", "安检面积\n(千平米)", "安检车辆数"];
                            data = [item.att_qty, item.att_per_qty, item.att_dog_qty, item.check_area, item.check_car_qty ];
                            color = ["#a8dc78"];
                        }else if(item.work_type == '治安防范'){
                            //巡逻次数、出勤人数、出勤犬数、巡逻时长（单位：小时）、查获违禁品数（件）、查获毒品（克）
                            xAxios = ["巡逻次数", "出勤人数", "出勤犬数", "巡逻时长\n(小时)"];
                            data = [item.att_qty, item.att_per_qty, item.att_dog_qty, item.work_hours ];
                            color = ["#adffc1"]
                        }else if(item.work_type == '其他（备勤）'){
                            //备勤次数、出勤人数、出勤犬数、备勤时长（单位：小时）、查获违禁品数（件）、查获毒品（克）
                            xAxios = ["备勤次数", "出勤人数", "出勤犬数", "备勤时长\n(小时)"];
                            data = [item.att_qty, item.att_per_qty, item.att_dog_qty, item.work_hours ];
                            color = ["#dbe3ad"]
                        }else if(item.work_type == '刑侦侦查'){
                            //出勤次数、出勤人数、出勤犬数、破案数、查获违禁品数（件）、查获毒品（克）
                            xAxios = ["出勤次数", "出勤人数", "出勤犬数", "破案数"];
                            data = [item.att_qty, item.att_per_qty, item.att_dog_qty, item.pa_qty ];
                            color = ["#00cee3"]
                        }

                        if(item.wjp_qty){
                            xAxios.push("查获违禁品\n数(件)");
                            data.push(item.wjp_qty);
                        }
                        if(item.dp_qty){
                            xAxios.push("查获毒品\n(克)");
                            data.push(item.dp_qty);
                        }
                        org_workData[item.work_type] = {
                            xAxios: xAxios,
                            data: data,
                            color: color
                        };
                    }
                }
                renderOrgMonthWork('搜爆安检');
                $('#work_type_org_' + lastTab_org).css('backgroundColor', '');
                $('#work_type_org_1').css('backgroundColor', '#002F75');
                lastTab_org = 1;
            }
        });
    }
    function renderOrgMonthWork(workType){
        var da = org_workData[workType];
        renderWorkSumView('chart_1', da.xAxios, da.data, da.color);
    }
    function renderOrgChart(orgName){
        var orgData = workUnitDataMapping[orgName];
        renderDogPowerData(
            '警犬占比',
            [
                {name: '警犬总数', value: orgData.dogQty},
                {name: '民警总数', value: orgData.empQty}
            ],
            'fj_col1',
            true
        );
        //config/getDogProAnalysis
        parent.doPost('config/getDogProAnalysis', {workPlace: orgData.orgName}, function (resp){
            console.log(resp);
            if(resp.success) {
                var data = [];
                for(var n in resp.result){
                    data.push({name: n, value: resp.result[n]})
                }
                renderDogPowerData('警犬专业构成', data, 'fj_col2', true, true);
            }
        });
        //config/getDogPowerAnalysis
        //警犬工作中状态、带犬人员职业数据
        parent.doPost('config/getDogPowerAnalysis', {workUnit: orgData.orgName}, function (resp){
            if(resp.success){
                var workStage = []; //警犬状态分布
                var userType = []; //训导员构成
                for(var i = 0; i<resp.result.length; i++){
                    var item = resp.result[i];
                    if(item.xtype == 'workStage'){
                        workStage.push({name: dogProMapping[item.xname], value: item.qty});
                    }else if(item.xtype == 'workType'){
                        userType.push({name: item.xname || '其他', value: item.qty});
                    }
                }
                renderDogPowerData( '警犬状态分布', workStage, 'fj_col1_1', true);
                renderDogPowerData( '训导员构成', userType, 'fj_col3', true);
            }
        });
    }
    function onSpecialDataClick(name){
        if(USER_ROLE == 'JuZhang' || USER_ROLE == 'SuperMan' || USER_ROLE == 'JiuZhiDui' ) {
            renderAreaData(name);
            renderOrgDesc(name);
            getWorkDataByOrgName(name);
        }
    };
    function renderMap() {
        var map_data = [];
        for(var n in areaDataMapping){
            var info = areaDataMapping[n];
            var selected = false;
            if(info.orgName == USER_INFO.workUnit){
                selected = true;
            }
            var val = parseInt(info.empQty/info.dogQty);
            map_data.push({name: n, /*selected: !selected,*/ value: val, policeman: info.policeCount, total: info.empQty, dog: info.dogQty});
        }
        var myChart = echarts.init(document.getElementById('main'), 'vintage');
        myChart.setOption(option = {
            visualMap: {
                left: -10000,
                type: 'piecewise',
                pieces: [
                    {min: 0, max: 19, color: '#00ff39'},
                    {min: 20, max: 30, color: '#fefb12'},
                    {min: 31, max: 50, color: '#fec23c'},
                    {min: 51, max: 10000, color: '#e73c43'}
                ],
                color: ['#E0022B', '#E09107', '#A3E00B']
            },
            tooltip: {
                trigger: 'item',
                formatter: function(params){
                    var d = params.data;
                    var val = d.value ? (d.value + ':1') : '-';
                    return '<div style="font-weight: bold;">' + d.name + '</div>带犬警力：' + d.policeman + '<br>警犬数量：' + d.dog + '<br>警犬占比：' + val;
                },
                position:function(p){
                    return [p[0] + 10, p[1] - 10];
                }
            },
            grid:{
                x: 80,
                width:'90%',
                borderWidth: 0
            },
            series: [
                {
                    type: 'map',
                    mapType: '北京',
                    mapLocation:{
                        x:'center',
                        y: 'center',
                        height: 500
                    },
                    label: {
                        emphasis: {
                            position: ['50%', '50%'],
                            textStyle: {
                                color: 'rgba(0, 0, 0, 0)'
                            }
                        }
                    },
                    data: map_data,
                    itemStyle: {
                        normal: {
                            borderColor: '#fff',
                            areaColor: '#fff',
                        },
                        emphasis: {
                            areaColor: 'rgba(0, 0, 0, 0.5)',
                            borderWidth: 0
                        }
                    },
                    animation: false
                }
            ]
        });
        myChart.on('click', function (params) {
            if(USER_ROLE == 'JuZhang' || USER_ROLE == 'SuperMan' || USER_ROLE == 'JiuZhiDui' ) {
                var city = params.name;
                var orgName = areaDataMapping[city].orgName;
                renderOrgDesc(orgName);
                renderAreaData(orgName);
                getWorkDataByOrgName(orgName);
            }
        });
        renderAreaData();
        if(is_show_all) {
            renderOrgDesc('刑侦总队');
            getWorkDataByOrgName('刑侦总队');
        }else{
            renderOrgDesc(USER_INFO.workUnit);
            getWorkDataByOrgName(USER_INFO.workUnit);
        }
    }
</script>

</html>